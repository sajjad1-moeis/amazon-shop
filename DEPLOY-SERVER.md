# راهنمای دیپلوی فرانت روی سرور

## ۱. اطمینان از آخرین نسخه

اگر سورس فرانت از گیت کش می‌کنی:

```bash
cd /root/...   # مسیر پوش فرانت (مثلاً /root/front_amazon یا هر جایی که هست)
git pull origin main
# یا اگر برنچ دیگری داری: git pull origin master
```

اگر سورس را با FTP یا دستی کپی کرده‌ای، آخرین نسخه را از همین پروژه (front_amazon/amazon-shop) روی سرور بریز.

---

## ۲. وصل بودن به بک‌اند درست

بک‌اند API روی همین سرور روی پورت **8080** است:  
`http://107.161.175.45:8080`

قبل از بیلد، یک فایل **`.env.local`** در روت پروژه فرانت بساز و آدرس API را بگذار:

```bash
cd /root/...   # مسیر پوش فرانت
echo 'NEXT_PUBLIC_API_URL=http://107.161.175.45:8080/api' > .env.local
```

یا اگر فایل نمونه داری:

```bash
cp env.server.example .env.local
# در صورت نیاز ویرایش کن: nano .env.local
```

**مهم:** مقدار `NEXT_PUBLIC_API_URL` حتماً قبل از `npm run build` تنظیم شود؛ وگرنه در بیلد استفاده نمی‌شود.

---

## ۳. نصب، بیلد و اجرا

```bash
npm ci
# یا: npm install

npm run build
npm run start
```

فرانت روی پورت **3000** بالا می‌آید:  
`http://107.161.175.45:3000`

برای اجرا در پس‌زمینه می‌توانی از **PM2** استفاده کنی:

```bash
npm install -g pm2
pm2 start npm --name "amazon-shop-front" -- start
pm2 save
pm2 startup
```

---

## ۴. چک کردن اتصال به بک‌اند

- در مرورگر برو به: `http://107.161.175.45:3000`
- اگر صفحه لود شد ولی داده‌ها (مثل محصولات، بنر، بلاگ) نمی‌آیند یا خطای شبکه می‌بینی، احتمالاً فرانت به آدرس اشتباه درخواست می‌زند.
- در DevTools (F12) تب Network را باز کن و ببین درخواست‌ها به کجا می‌روند؛ باید به `http://107.161.175.45:8080/api/...` باشند.

---

## خلاصه

| مورد | مقدار |
|------|--------|
| آدرس فرانت | http://107.161.175.45:3000 |
| آدرس بک‌اند API | http://107.161.175.45:8080 |
| متغیر محیطی روی سرور | `NEXT_PUBLIC_API_URL=http://107.161.175.45:8080/api` در `.env.local` |
| ترتیب کار | `git pull` → ساخت `.env.local` → `npm run build` → `npm run start` (یا PM2) |
